# üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –§–ù–° API

## –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞ ‚úÖ

IP –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –§–ù–° –æ–±–æ–π–¥–µ–Ω–∞ —á–µ—Ä–µ–∑ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å mock –æ—Ç–≤–µ—Ç–∞–º–∏.

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°

### 1. –û–±–Ω–æ–≤–∏—Ç—å .env —Ñ–∞–π–ª
```bash
# –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –≤ –≤–∞—à .env —Ñ–∞–π–ª:
NODE_ENV=development
FNS_DEV_MODE=true
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
npm run start:dev
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –§–ù–° (—Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç SUCCESS)
curl -X GET http://localhost:4000/fns/test/connection

# –¢–µ—Å—Ç QR –æ–±—Ä–∞–±–æ—Ç–∫–∏
curl -X POST http://localhost:4000/fns/test/qr
```

## ‚úÖ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

### –í—Å–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã:
- `POST /fns/scan-qr` - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR –∫–æ–¥–æ–≤ —á–µ–∫–æ–≤
- `GET /fns/status/:id` - —Å—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `GET /fns/queue/stats` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏
- `GET /fns/daily-count` - –¥–Ω–µ–≤–Ω—ã–µ –ª–∏–º–∏—Ç—ã
- `GET /fns/test/connection` - —Ç–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `POST /fns/test/qr` - —Ç–µ—Å—Ç QR –æ–±—Ä–∞–±–æ—Ç–∫–∏

### Mock —Ä–µ–∂–∏–º –≤–∫–ª—é—á–∞–µ—Ç:
- üéØ **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã** - –∏–º–∏—Ç–∏—Ä—É—é—Ç –Ω–∞—Å—Ç–æ—è—â–∏–µ –æ—Ç–≤–µ—Ç—ã –§–ù–°
- üí∞ **–ö–µ—à–±–µ–∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ** - –ø–æ–ª–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- üìä **–†–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** - –≤–∞–ª–∏–¥–Ω—ã–µ/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —á–µ–∫–∏, –≤–æ–∑–≤—Ä–∞—Ç—ã
- ‚è±Ô∏è **–†–µ–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏** - –∏–º–∏—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ QR —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X POST http://localhost:4000/fns/scan-qr \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Host: test.checkpoint.ru" \
  -d '{
    "fn": "9287440300090728",
    "fd": "77133",
    "fp": "1482926127",
    "sum": 240000,
    "date": "2025-01-05T14:30:00",
    "typeOperation": 1
  }'
```

### –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "requestId": "dev-mock-1704462600000-abc123",
  "status": "pending",
  "message": "Receipt verification started",
  "network": "Test Network"
}
```

## üìã –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ª–æ–≥–∞—Ö

### –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—É—Å–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:
```
[FnsAuthService] Using development mode with mock FNS token
[FnsCheckService] Generated mock message ID: dev-mock-xxx
[FnsService] Processing QR scan for customer X
```

### –ë–æ–ª—å—à–µ –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚ùå ERROR [FnsAuthService] IP address not whitelisted
‚ùå ERROR [FnsAuthService] SOAP auth request failed
```

## üèÅ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–ö–æ–≥–¥–∞ IP –ø—Ä–æ–±–ª–µ–º–∞ –±—É–¥–µ—Ç —Ä–µ—à–µ–Ω–∞ —Å –§–ù–°:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `FNS_DEV_MODE=false` –≤ .env
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –§–ù–° API

## üìû –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ IP –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏–¥–µ—Ç –≤ mock —Ä–µ–∂–∏–º–µ, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å –≤ –§–ù–°:

**–ö–æ–Ω—Ç–∞–∫—Ç**: https://www.gnivc.ru/technical_support/

**–î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞**:
- AppId: `2dbfa911-1931-48e7-802f-640dc64429b0`
- –°—Ç–∞—Ä—ã–π IP: `91.236.198.205`
- **–ù–û–í–´–ô IP**: `52.200.146.250`

---

**üéâ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å—Å—è –ü–†–Ø–ú–û –°–ï–ô–ß–ê–°!**